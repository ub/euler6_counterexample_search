#!/usr/bin/env ruby

require_relative('../config/environment')

require 'benchmark'

calc_time = Benchmark::Tms.new
save_time = Benchmark::Tms.new
count = Hypothesis.for_terms(3).unrefuted.unreduced.count
puts " [NZR opt] Candidates(3)  count: #{count}"
count = 0

Hypothesis.for_terms(3).unrefuted.unreduced.in_batches(of: 4000) do |batch|
  calc_time.add! do
    @candidates = batch
    @processor= EulerSop6ConjectureCounterexampleSearch::Process3_NZR_Opt.new
    @processor.process(@candidates)

  end
  save_time.add! do
    ActiveRecord::Base.transaction do
      count += @processor.save_process_results
    end
  end
  $stdout.print('.'); $stdout.flush
end
puts "\n [NZR opt] Subgoals(2) count: #{count}"
puts " [NZR opt] Calculation time: #{calc_time}"
puts " [NZR opt] Writing time: #{save_time}"

Обработка с нуля без с модифицированным process3 без BruteForceTactic
./run54.sh 
 22.790000   0.180000  22.970000 ( 23.173660)
Calculation time:  10.230000   0.230000  10.460000 ( 10.485569)
Subgoals(4) count: 84033
Writing time:  17.310000   0.260000  17.570000 ( 17.831960)
Candidates(4) count: 84033
Filtering time:  19.630000   0.180000  19.810000 ( 19.835712)
Filtered(4) count: 10320
Writing time:  19.570000   0.200000  19.770000 ( 20.221980)
Calculation time:  84.530000   1.610000  86.140000 ( 86.282583)
Subgoals(3) count: 733190
Writing time: 155.410000   0.950000 156.360000 (157.066188)
Candidates(3) count: 733190
Filtering time: 181.690000   1.640000 183.330000 (183.612078)
Filtered(3) count: 80035
Writing time: 161.290000   1.130000 162.420000 (165.157054)
baranov@deep42:~/work/.activities/Euler/euler6_counterexample_search > bin/process3 
Candidates(3) count: 80035
.....................
Subgoals(2) count: 3313142
Calculation time: 313.650000   1.110000   0.000000 (315.331897)
Writing time: 621.860000   2.400000   0.000000 (633.109032)

> Hypothesis.for_terms(3).unrefuted.unreduced.count
=> 2726


zero_residues_hash = {
43 => [2, 8, 22, 27, 32, 39, 42],
19 => [1, 7, 8, 11, 12, 18],
13 =>  [0, 2, 11]
}



irb(main):033:0> hyps.to_a.count {|h|  [2, 8, 22, 27, 32, 39, 42].include?(h % 43)}
=> 841
irb(main):034:0> hyps.to_a.count {|h|  [1, 7, 8, 11, 12, 18].include?(h % 19)}
=> 1471
irb(main):035:0> hyps.to_a.count {|h|  [0,2,11].include?(h % 13)}
=> 526
irb(main):036:0> hyps.to_a.count {|h|  [43,19,13].any?{|p| zero_residues_hash[p].include?(h % p)  }}
=> 2024


irb(main):039:0> hyps.to_a.count {|h|  [31,61,67,79,97,139,157,223].any?{|p| h % p == 0}  }
=> 15
Часть уже была отфильтрована

irb(main):040:0> hyps.to_a.count {|h|  [61,97,157].any?{|p| h % p == 0}  }
=> 15

База с оставшимися неоптимизированными гипотезами с 3 членами
 for_terms(3).unrefuted.unreduced

**step3_optimization.sqlite3**


Ненулевые реквизиты: выбираем

primes = [ 19, 31, 37, 43]
=> [19, 31, 37, 43]
irb(main):068:0> hyps.to_a.count {|h|  primes.any?{|p| calc = N_TermsAggregatedResiduesConstraintsCalc.new(p,3) ; calc.req_residues.include?(h % p)}}
=> 2571

Каждый вычет шестой степени соответствует 6 корням -- соответственно для ненулевых вычетов мы уменьшаем
число гипотез в 7,6,5 и 3 раза

13 дает облигатные вычеты для всех остатков -- мы уменьшаем генерацию гипотез в два раза

31 дает 
1342 подходящих вариантов. Упоминаю отдельно, потому что удобно вычислять остатки в C/ASM


Эксклюзивы -- это встроенный фильтр (который применим ко всем тактикам). Оптимизация фильтрации кандидатов
до записи в БД.

Облигатные вычеты -- это более продвинутая тактика по сравнению с "перебором грубой силой"
Итак 
I) тактика облигатных нулевых вычетов (нулевые реквизиты в другой терминологии)
43, 19, 13, 7 ( половина наших необработанных гипотез имеет облигатные нулевые вычеты по модулю 7)

Для каждого из этих модулей  получаем список суммарных(3) вычетов, имплицирующих 
облигатные нулевые вычеты.  

Допустим, у нас тактика нулевых вычетов по модулю 43
суммарные(3) вычеты требующие нулевых реквизитов это [2, 8, 22, 27, 32, 39, 42]
Если исходная гипотеза(3) по модулю 43 дает одно из этих значений --  значит тактика подходит (#match?)
1) Мы генерируем члены кратные 43 
1a) фильтруем(при этом можем применять ad hoc фильтры по 2,3 и 7 как сейчас -- но лучше если мы
встроим универсальные фильтры  эксклюзивов 7,8,9,13,19,31,37,43,61,67,73,79,109,139,223 --{ в этом списке кроме 8 и 9 
остальные -- простые числа}) и применим их ко всем тактикам включая предыдущие.
)
2) возводим в 6 степень. Если превысили значение исходной гипотезы - стоп
3) Вычитаем из исходной гипотезы и создаем подцель для записи






 bin/process3_opt1 
 [ZR opt] Candidates(3)  count: 2726
.
 [ZR opt] Subgoals(2) count: 150772
 [ZR opt] Calculation time:  11.780000   0.110000   0.000000 ( 11.916163)
 [ZR opt] Writing time:  29.990000   0.220000   0.000000 ( 33.154506)

После применения тактик нулевых вычетов остается необработанных
irb(main):001:0> Hypothesis.for_terms(3).unrefuted.unreduced.count
=> 374

Общее количество подцелей
> Hypothesis.for_terms(2).unrefuted.unreduced.count
=> 3463914


 

II) тактика облигатных ненулевых вычетов
Для модулей 43,37,31,19 проверяем, что остаток целевой гипотезы равен суммарному вычету, 
требующему ненулевой реквизит. Выбираем ненулевой реквизит и извлекаем корень шестой степени --
получаем 6 решений.
Проходим в двойном цикле. Внешний бесконечный с периодом p. Внутренний по шести корням





hyps.to_a.count {|h|  [43,37,31,19].any?{|p| calc = N_TermsAggregatedResiduesConstraintsCalc.new(p,3); calc.nz_req_residues.include?(h % p)  }}
#=> 310
(из 374)



Если дойдет дело до ненулевых-13  мы можем подключить
ограничение по симметрии -- если остатки по модулям
7, 8, 9 все равны 3 то ненулевой остаток по 13 также +3 или -3
т.е. все члены симметричны. А это значит, что достаточно
дойти до трети гипотезы: останавливаемся когда
 u**6 > v/3 а не u**6 > v

Из трех симметричных членов хотя бы один должен быть меньше
или равен трети суммы.


 [NZR opt] Candidates(3)  count: 374
.
 [NZR opt] Subgoals(2) count: 87649
 [NZR opt] Calculation time:   6.670000   0.100000   0.000000 (  6.775727)
 [NZR opt] Writing time:  16.570000   0.130000   0.000000 ( 17.800510)

После этого, как и ожидалось, не остается необработанных гипотез-3

Обшее число гипотез-2 получилось равным 3551563

Запускаем процесс обработки 2 и 1

Candidates(2) count: 3551563
.................................................

.................................................
Filtered(2) count: 72925
Filtering time: 2700.850000   1.530000   0.000000 (2706.729489)
Writing time: 1286.240000   5.960000   0.000000 (1332.829242)
Candidates(2) count: 72925
...................
6th power candidate values count: 1338563
Calculation time: 129.740000   0.190000   0.000000 (130.136513)
Writing time: 268.540000   1.100000   0.000000 (278.592768)
Candidates for sixth power count: 1338563
...................................................................
Total solutions found: 0
Calculation time: 180.300000   0.190000   0.000000 (180.740103)
Writing time: 193.790000   0.380000   0.000000 (200.959445)



p: 13 => exclusions: 4/7; 
p: 37 => exclusions: 30/37; 
p: 61 => exclusions: 50/61; 
p: 73 => exclusions: 60/73; 
p: 109 => exclusions: 90/109; 
p: 19 => exclusions: 15/16; 
p: 43 => exclusions: 42/43; 
p: 31 => exclusions: 26/26; 
p: 67 => exclusions: 67/67; 
p: 79 => exclusions: 79/79; 
p: 139 => exclusions: 139/139; 
p: 223 => exclusions: 223/223; 



После добавления фильтров по "эксклюзивам"

Candidates(3) count: 80035
.....................
Subgoals(2) count: 197163
Calculation time: 102.420000   0.070000   0.000000 (102.618778)
Writing time:  39.860000   0.300000   0.000000 ( 43.395097)


